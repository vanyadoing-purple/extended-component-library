{"version":3,"file":"place_data_consumer.js","sourceRoot":"","sources":["../../src/place_building_blocks/place_data_consumer.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {consume, createContext} from '@lit/context';\r\nimport {PropertyValues} from 'lit';\r\nimport {property, state} from 'lit/decorators.js';\r\n\r\nimport {BaseComponent} from '../base/base_component.js';\r\nimport {attachContextRoot} from '../utils/context_utils.js';\r\nimport type {Place, PlaceResult} from '../utils/googlemaps_types.js';\r\nimport {isPlaceResult, makePlaceFromPlaceResult} from '../utils/place_utils.js';\r\n\r\n// If this module is loaded before the definitions of other elements\r\n// (specifically, Place data providers), adding a context root ensures\r\n// registration of data consumers by late-upgraded data providers.\r\nattachContextRoot();\r\n\r\n/**\r\n * Registration functions passed from a `PlaceDataProvider` via context. The\r\n * `PlaceDataConsumer` calls these to register/unregister itself with the data\r\n * provider, allowing the provider to get its required fields and trigger\r\n * updates when place data is loaded.\r\n */\r\nexport interface PlaceConsumerRegistration {\r\n  registerPlaceConsumer: (consumer: PlaceDataConsumer) => void;\r\n  unregisterPlaceConsumer: (consumer: PlaceDataConsumer) => void;\r\n}\r\n\r\nexport const placeContext = createContext<Place|undefined>(Symbol('place'));\r\n\r\nexport const placeConsumerRegistrationContext =\r\n    createContext<PlaceConsumerRegistration>(\r\n        Symbol('place-consumer-registration'));\r\n\r\n/**\r\n * Base class for components which render Place data provided elsewhere; i.e.\r\n * Place Representation Building Blocks.\r\n *\r\n * This class implements functionality to retrieve a `Place` or `PlaceResult`\r\n * via context from a parent `<gmpx-place-data-provider>` component.\r\n */\r\nexport abstract class PlaceDataConsumer extends BaseComponent {\r\n  /**\r\n   * @ignore\r\n   * Place consumer registration functions, passed from a parent\r\n   * `PlaceDataProvider` via context.\r\n   */\r\n  @consume({context: placeConsumerRegistrationContext, subscribe: true})\r\n  @property({attribute: false})\r\n  contextRegistration?: PlaceConsumerRegistration;\r\n\r\n  /**\r\n   * @ignore\r\n   * Place data passed from a parent `PlaceDataProvider` via context.\r\n   */\r\n  @consume({context: placeContext, subscribe: true})\r\n  @property({attribute: false})\r\n  contextPlace: Place|undefined;\r\n\r\n  /**\r\n   * Place data to render, overriding anything provided by context.\r\n   */\r\n  get place():\r\n      // Accept data in the form of either the new `Place` class from Places API\r\n      // or the legacy `PlaceResult` class and convert to the former internally.\r\n      Place|PlaceResult|null|undefined {\r\n    return this.placeInternal;\r\n  }\r\n  set place(value: Place|PlaceResult|null|undefined) {\r\n    this.placeInternal = value;\r\n    this.updatePlaceV2(value);\r\n  }\r\n\r\n  /**\r\n   * This read-only property and attribute indicate whether the component\r\n   * has the required Place data to display itself.\r\n   *\r\n   * Use the attribute to target CSS rules if you wish to hide this component,\r\n   * or display alternate content, when there's no valid data.\r\n   */\r\n  @property({type: Boolean, attribute: 'no-data', reflect: true}) noData = true;\r\n\r\n  @state() private placeV2?: Place|null;\r\n\r\n  private placeInternal?: Place|PlaceResult|null;\r\n\r\n  protected override willUpdate(changedProperties: PropertyValues) {\r\n    if (changedProperties.has('contextPlace') && !this.placeV2) {\r\n      // Trigger callback if Place from context changes and is not overridden.\r\n      this.placeChangedCallback(\r\n          this.contextPlace, changedProperties.get('contextPlace'));\r\n    }\r\n    // Always refresh the value of `noData` on update; this also reverts any\r\n    // change to the property from outside the component since it's read-only.\r\n    const place = this.getPlace();\r\n    this.noData = !(place && this.placeHasData(place));\r\n    if (changedProperties.has('contextRegistration')) {\r\n      this.contextRegistration?.registerPlaceConsumer(this);\r\n    }\r\n  }\r\n\r\n  override disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    this.contextRegistration?.unregisterPlaceConsumer(this);\r\n  }\r\n\r\n  /**\r\n   * Callback to be invoked when the object returned by calling `getPlace()`\r\n   * changes, including when fields in the object are newly populated.\r\n   *\r\n   * @param value New value of the object returned by `getPlace()`.\r\n   * @param oldValue Old value of the object returned by `getPlace()`.\r\n   */\r\n  protected placeChangedCallback(value?: Place|null, oldValue?: Place|null) {}\r\n\r\n  /**\r\n   * @ignore\r\n   * Components should override this method if they wish to show a `no-data`\r\n   * attribute for use with CSS styling.\r\n   */\r\n  protected placeHasData(place: Place): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   * Returns any Place fields required for this component to render content.\r\n   *\r\n   * A parent `<gmpx-place-data-provider>` component will call this method\r\n   * before making an API call to determine which Place fields to request.\r\n   */\r\n  abstract getRequiredFields(): Array<keyof Place>;\r\n\r\n  /**\r\n   * Returns the Place data object to be used when rendering.\r\n   *\r\n   * If a `Place` or `PlaceResult` object is specified directly on the component\r\n   * as a property, it will take priority. Otherwise, this method attempts to\r\n   * return one provided by a parent `<gmpx-place-data-provider>` element.\r\n   *\r\n   * The convention for data providers is to use `undefined` to indicate Place\r\n   * data has not been requested, or is in the process of being requested. The\r\n   * value `null` indicates that Place data could not be found.\r\n   */\r\n  protected getPlace(): Place|null|undefined {\r\n    return this.placeV2 ?? this.contextPlace;\r\n  }\r\n\r\n  private async updatePlaceV2(value?: Place|PlaceResult|null) {\r\n    const oldPlace = this.getPlace();\r\n    if (!value || !isPlaceResult(value)) {\r\n      this.placeV2 = value;\r\n    } else {\r\n      this.placeV2 = await makePlaceFromPlaceResult(value, this);\r\n    }\r\n    this.placeChangedCallback(this.placeV2, oldPlace);\r\n  }\r\n}\r\n"]}