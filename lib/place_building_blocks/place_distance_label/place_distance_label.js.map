{"version":3,"file":"place_distance_label.js","sourceRoot":"","sources":["../../../src/place_building_blocks/place_distance_label/place_distance_label.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {css, html, PropertyValues} from 'lit';\r\nimport {customElement, property, state} from 'lit/decorators.js';\r\n\r\nimport {WebFont, WebFontController} from '../../base/web_font_controller.js';\r\nimport type {LatLng, LatLngLiteral, Place} from '../../utils/googlemaps_types.js';\r\nimport {makeWaypoint} from '../../utils/place_utils.js';\r\nimport {PlaceDataConsumer} from '../place_data_consumer.js';\r\n\r\nimport {DirectionsController} from './directions_controller.js';\r\n\r\n\r\ntype TravelMode = google.maps.TravelMode;\r\ntype TravelModeAttribute = Lowercase<TravelMode>;\r\n\r\nfunction getIconNameFromTravelMode(travelMode: TravelModeAttribute): string {\r\n  switch (travelMode) {\r\n    case 'bicycling':\r\n      return 'directions_bike';\r\n    case 'transit':\r\n      return 'directions_subway';\r\n    case 'walking':\r\n      return 'directions_walk';\r\n    default:\r\n      return 'directions_car';\r\n  }\r\n}\r\n\r\n/**\r\n * Converts data into a format suitable for specifying a place in the\r\n * `DirectionsRequest`.\r\n *\r\n * @return A `google.maps.Place` object that is identified by exactly one of\r\n *     Place ID, location, or query, with preference in that order.\r\n */\r\nfunction makePlaceForDirectionsRequest(data: LatLng|LatLngLiteral|Place|null|\r\n                                       undefined): google.maps.Place|null {\r\n  if (!data) return null;\r\n  const {placeId, location, query} = makeWaypoint(data);\r\n  if (placeId) return {placeId};\r\n  if (location) return {location};\r\n  if (query) return {query};\r\n  return null;\r\n}\r\n\r\n/**\r\n * Component that displays as text the distance to this place from an origin,\r\n * or the duration if a travel mode is also specified.\r\n *\r\n * @package Intended for template usage in the Place Overview component only.\r\n */\r\n@customElement('gmpx-place-distance-label-internal')\r\nexport class PlaceDistanceLabel extends PlaceDataConsumer {\r\n  static override styles = css`\r\n    .icon {\r\n      font-size: inherit;\r\n      line-height: inherit;\r\n      vertical-align: bottom;\r\n    }\r\n  `;\r\n\r\n  /**\r\n   * Travel mode to be used when computing transit time from `origin`.\r\n   * If undefined (default), this component will render the distance instead.\r\n   */\r\n  @property({attribute: 'travel-mode', reflect: true, type: String})\r\n  travelMode?: TravelModeAttribute;\r\n\r\n  /** Starting location or Place. */\r\n  @property({attribute: false}) origin?: LatLng|LatLngLiteral|Place;\r\n\r\n  @state() private directionsData?: google.maps.DirectionsLeg;\r\n\r\n  protected readonly fontLoader =\r\n      new WebFontController(this, [WebFont.MATERIAL_SYMBOLS_OUTLINED]);\r\n\r\n  private readonly directionsController = new DirectionsController(this);\r\n  private isFetchingDirectionsData = false;\r\n\r\n  protected override willUpdate(changedProperties: PropertyValues) {\r\n    super.willUpdate(changedProperties);\r\n\r\n    // Re-fetch directions data if either origin or travel mode changes.\r\n    if (changedProperties.has('origin') ||\r\n        changedProperties.has('travelMode')) {\r\n      this.updateDirectionsData();\r\n    }\r\n  }\r\n\r\n  protected override placeChangedCallback(\r\n      value?: Place|null, oldValue?: Place|null) {\r\n    // Re-fetch directions data if Place ID of the destination changes.\r\n    if (value?.id !== oldValue?.id) {\r\n      this.updateDirectionsData();\r\n    }\r\n  }\r\n\r\n  protected override render() {\r\n    const {distance, duration} = this.directionsData ?? {};\r\n    if (this.isFetchingDirectionsData || !distance) return html``;\r\n\r\n    if (!(this.travelMode && duration)) {\r\n      return html`<span>${distance.text}</span>`;\r\n    }\r\n\r\n    return html`\r\n      <span class=\"icon material-symbols-outlined\">\r\n        ${getIconNameFromTravelMode(this.travelMode)}\r\n      </span>\r\n      <span>${duration.text}</span>\r\n    `;\r\n  }\r\n\r\n  /** @ignore */\r\n  getRequiredFields(): Array<keyof Place> {\r\n    return [];  // Place ID alone is sufficient for a Directions request.\r\n  }\r\n\r\n  protected override placeHasData(): boolean {\r\n    return this.directionsData != null;\r\n  }\r\n\r\n  private async updateDirectionsData() {\r\n    if (this.isFetchingDirectionsData) return;\r\n    const place = this.getPlace();\r\n    const origin = makePlaceForDirectionsRequest(this.origin);\r\n    const destination = makePlaceForDirectionsRequest(place);\r\n    if (origin && destination) {\r\n      this.isFetchingDirectionsData = true;\r\n      const result = await this.directionsController.route({\r\n        origin,\r\n        destination,\r\n        travelMode: (this.travelMode?.toUpperCase() ?? 'DRIVING') as TravelMode,\r\n      });\r\n      this.directionsData = result?.routes[0]?.legs[0];\r\n      // When switching the travel mode between driving and undefined,\r\n      // this.directionsData is unchanged but we still want an update.\r\n      this.requestUpdate();\r\n    } else {\r\n      this.directionsData = undefined;\r\n    }\r\n    this.isFetchingDirectionsData = false;\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'gmpx-place-distance-label-internal': PlaceDistanceLabel;\r\n  }\r\n}\r\n"]}