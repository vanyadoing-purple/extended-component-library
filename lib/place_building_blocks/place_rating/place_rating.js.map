{"version":3,"file":"place_rating.js","sourceRoot":"","sources":["../../../src/place_building_blocks/place_rating/place_rating.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {css, html} from 'lit';\r\nimport {customElement, property} from 'lit/decorators.js';\r\nimport {map} from 'lit/directives/map.js';\r\nimport {when} from 'lit/directives/when.js';\r\n\r\nimport {GMPX_RATING_COLOR, GMPX_RATING_COLOR_EMPTY} from '../../base/common_styles.js';\r\nimport {LocalizationController} from '../../base/localization_controller.js';\r\nimport type {Place} from '../../utils/googlemaps_types.js';\r\nimport {PlaceDataConsumer} from '../place_data_consumer.js';\r\n\r\n\r\nconst MIN_RATING = 1;\r\nconst MAX_RATING = 5;\r\n\r\nenum IconType {\r\n  FULL = 'full',\r\n  HALF = 'half',\r\n  EMPTY = 'empty',\r\n}\r\n\r\nfunction toStarIcons(rating: number): IconType[] {\r\n  let numHalfStars = Math.round(rating * 2);\r\n  const icons = [];\r\n  while (numHalfStars > 1) {\r\n    icons.push(IconType.FULL);\r\n    numHalfStars -= 2;\r\n  }\r\n  if (numHalfStars > 0) {\r\n    icons.push(IconType.HALF);\r\n  }\r\n  while (icons.length < MAX_RATING) {\r\n    icons.push(IconType.EMPTY);\r\n  }\r\n  return icons;\r\n}\r\n\r\n/**\r\n * Renders a place's star rating in either full (4.9 ★★★★★) or condensed\r\n * (4.9 ★) form.\r\n *\r\n * @cssproperty [--gmpx-rating-color] - Color of the stars in a star\r\n * rating.\r\n * @cssproperty [--gmpx-rating-color-empty] - Color of the empty stars\r\n * in a star rating.\r\n */\r\n@customElement('gmpx-place-rating')\r\nexport class PlaceRating extends PlaceDataConsumer {\r\n  static override styles = css`\r\n    .star-icon.full {\r\n      color: ${GMPX_RATING_COLOR};\r\n    }\r\n    .star-icon.empty {\r\n      color: ${GMPX_RATING_COLOR_EMPTY};\r\n    }\r\n    .star-icon.half {\r\n      color: ${GMPX_RATING_COLOR_EMPTY};\r\n      position: relative;\r\n    }\r\n    .star-icon.half::before {\r\n      color: ${GMPX_RATING_COLOR};\r\n      content: '\\\\2605';\r\n      overflow: hidden;\r\n      position: absolute;\r\n      width: 50%;\r\n    }\r\n  `;\r\n\r\n  /**\r\n   * Render a condensed star rating (4.9 ★) instead of the full format\r\n   * (4.9 ★★★★★).\r\n   */\r\n  @property({type: Boolean, reflect: true}) condensed = false;\r\n\r\n  protected readonly getMsg = LocalizationController.buildLocalizer(this);\r\n\r\n  protected override render() {\r\n    const rating = this.getRating();\r\n    return when(rating !== null, () => {\r\n      const icons = this.condensed ? [IconType.FULL] : toStarIcons(rating!);\r\n      // clang-format off\r\n      return html`\r\n        <span role=\"img\" aria-label=${\r\n            this.getMsg('PLACE_RATING_ARIA_LABEL', rating!.toFixed(1))}>\r\n          <span aria-hidden=\"true\">\r\n            <span>${rating!.toFixed(1)}</span>\r\n            ${map(icons, (iconType) => {\r\n              return html`<span class=\"star-icon ${iconType}\">&#x2605;</span>`;\r\n            })}\r\n          </span>\r\n        </span>\r\n      `;\r\n      // clang-format on\r\n    });\r\n  }\r\n\r\n  /** @ignore */\r\n  getRequiredFields(): Array<keyof Place> {\r\n    return ['rating'];\r\n  }\r\n\r\n  protected override placeHasData(place: Place): boolean {\r\n    return (place.rating != null);\r\n  }\r\n\r\n  private getRating(): number|null {\r\n    const rating = this.getPlace()?.rating;\r\n    if (!rating || rating < MIN_RATING || rating > MAX_RATING) return null;\r\n    return rating;\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'gmpx-place-rating': PlaceRating;\r\n  }\r\n}\r\n"]}