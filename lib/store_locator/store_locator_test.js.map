{"version":3,"file":"store_locator_test.js","sourceRoot":"","sources":["../../src/store_locator/store_locator_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// import 'jasmine'; (google3-only)\r\n\r\nimport {html, nothing} from 'lit';\r\n\r\nimport type {OverlayLayout} from '../overlay_layout/overlay_layout.js';\r\nimport type {PlaceOverview} from '../place_overview/place_overview.js';\r\nimport type {PlacePicker} from '../place_picker/place_picker.js';\r\nimport {Environment} from '../testing/environment.js';\r\nimport {makeFakeDistanceMatrixResponse} from '../testing/fake_distance_matrix.js';\r\nimport type {FakeMapElement} from '../testing/fake_gmp_components.js';\r\nimport {FakeLatLng, FakeLatLngBounds} from '../testing/fake_lat_lng.js';\r\nimport {Deferred} from '../utils/deferred.js';\r\nimport type {LatLngLiteral, Place} from '../utils/googlemaps_types.js';\r\n\r\nimport {DistanceMeasurer} from './distances.js';\r\nimport {FeatureSet, StoreLocatorListing} from './interfaces.js';\r\nimport {StoreLocator} from './store_locator.js';\r\n\r\nconst LISTING_A: StoreLocatorListing = {\r\n  title: 'listing A',\r\n  addressLines: ['address A1', 'address A2'],\r\n  position: {lat: 1, lng: 1},\r\n  placeId: 'placeIdA'\r\n};\r\n\r\nconst LISTING_B: StoreLocatorListing = {\r\n  title: 'listing B',\r\n  addressLines: ['address B1', 'address B2'],\r\n  position: {lat: 2, lng: 3},\r\n  placeId: 'placeIdB'\r\n};\r\n\r\ndescribe('StoreLocator', () => {\r\n  const env = new Environment();\r\n\r\n  beforeAll(() => {\r\n    // Define fake implementations for <gmp-map> and <gmp-advanced-marker>.\r\n    env.defineFakeMapElement();\r\n    env.defineFakeAdvancedMarkerElement();\r\n  });\r\n\r\n  beforeEach(() => {\r\n    DistanceMeasurer.reset();\r\n\r\n    // Silence Lit warnings \"Element <foo> scheduled an update (generally\r\n    // because a property was set) after an update completed, causing a new\r\n    // update to be scheduled.\"\r\n    const originalWarn = console.warn;\r\n    spyOn(console, 'warn').and.callFake((...args) => {\r\n      if (args.length > 0 &&\r\n          args[0].match(/^Element \\S+ scheduled an update/gm)) {\r\n        return;\r\n      }\r\n      originalWarn.call(console, ...args);\r\n    });\r\n  });\r\n\r\n  async function prepareState(config: {\r\n    listings?: StoreLocatorListing[], featureSet: FeatureSet,\r\n    mapOptions?: Partial<google.maps.MapOptions>\r\n  }) {\r\n    const root = env.render(html`\r\n      <gmpx-store-locator .listings=${config.listings} .featureSet=${\r\n        config.featureSet} .mapOptions=${config.mapOptions ?? nothing}>\r\n      </gmpx-store-locator>\r\n    `);\r\n    await env.waitForStability();\r\n\r\n    const locator = root.querySelector<StoreLocator>('gmpx-store-locator')!;\r\n    const locatorRoot = locator.renderRoot as HTMLElement;\r\n    const map = locatorRoot.querySelector<FakeMapElement>('gmp-map');\r\n    const overlayLayout =\r\n        locatorRoot.querySelector<OverlayLayout>('gmpx-overlay-layout');\r\n    const placeOverview =\r\n        locatorRoot.querySelector<PlaceOverview>('gmpx-place-overview');\r\n    const placePicker =\r\n        locatorRoot.querySelector<PlacePicker>('gmpx-place-picker');\r\n    const resultsList =\r\n        locatorRoot.querySelector<HTMLUListElement>('#location-results-list');\r\n    const sectionName = locatorRoot.querySelector('.section-name');\r\n    return {\r\n      locator,\r\n      locatorRoot,\r\n      map,\r\n      overlayLayout,\r\n      placeOverview,\r\n      placePicker,\r\n      resultsList,\r\n      sectionName,\r\n    };\r\n  }\r\n\r\n  it('is defined', () => {\r\n    const el = document.createElement('gmpx-store-locator');\r\n    expect(el).toBeInstanceOf(StoreLocator);\r\n  });\r\n\r\n  it('renders only the font loader until initialized with async dependencies',\r\n     async () => {\r\n       const libraryImport = new Deferred();\r\n       env.importLibrarySpy!.and.returnValue(libraryImport.promise);\r\n\r\n       const {locatorRoot} =\r\n           await prepareState({featureSet: FeatureSet.ADVANCED});\r\n\r\n       expect([...locatorRoot.children].map(x => x.tagName)).toEqual(['LINK']);\r\n     });\r\n\r\n  it('updates the map bounds for the specified listings', async () => {\r\n    const {map} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n\r\n    expect(map?.innerMap?.fitBounds)\r\n        .toHaveBeenCalledOnceWith(\r\n            new FakeLatLngBounds({north: 2, south: 1, east: 3, west: 1}));\r\n  });\r\n\r\n  it('pans the map when a list item is selected', async () => {\r\n    const {map, resultsList} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n\r\n    (resultsList!.children[0] as HTMLElement).click();\r\n    await env.waitForStability();\r\n\r\n    expect(map?.innerMap?.panTo).toHaveBeenCalledOnceWith(LISTING_A.position);\r\n  });\r\n\r\n  it('sets default map options if none are specified', async () => {\r\n    const {map} = await prepareState(\r\n        {listings: [LISTING_A], featureSet: FeatureSet.BASIC});\r\n\r\n    expect(map?.innerMap?.setOptions).toHaveBeenCalledWith({\r\n      mapTypeControl: false,\r\n      maxZoom: 17,\r\n      streetViewControl: false,\r\n    });\r\n  });\r\n\r\n  it('sets map options when specified', async () => {\r\n    const {map} = await prepareState({\r\n      listings: [LISTING_A, LISTING_B],\r\n      featureSet: FeatureSet.ADVANCED,\r\n      mapOptions: {zoom: 10}\r\n    });\r\n\r\n    expect(map?.innerMap?.setOptions).toHaveBeenCalledWith({\r\n      zoom: 10,\r\n    });\r\n  });\r\n\r\n  it('initially displays locations in their original order', async () => {\r\n    const {resultsList, sectionName} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n\r\n    expect(sectionName!.textContent).toContain('All locations (2)');\r\n    const items = resultsList!.children;\r\n    expect(items[0].textContent).toContain(LISTING_A.addressLines![0]);\r\n  });\r\n\r\n  it('does not show a search input in basic mode', async () => {\r\n    const {placePicker} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.BASIC});\r\n\r\n    expect(placePicker).toBeNull();\r\n  });\r\n\r\n  it('sorts locations by travel distance and updates map bounds when a user location is entered',\r\n     async () => {\r\n       const origin = new FakeLatLng(10, 10);\r\n       const {placePicker, map, resultsList, sectionName} = await prepareState(\r\n           {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n       map?.innerMap.fitBounds.calls.reset();\r\n       spyOnProperty(placePicker!, 'value').and.returnValue({\r\n         id: 'foo_origin_id',\r\n         location: origin,\r\n         addressComponents: [{\r\n           types: ['foo', 'country'],\r\n           shortText: 'US',\r\n           longText: 'United States'\r\n         }],\r\n       } as Partial<Place>as Place);\r\n\r\n       // Distance Matrix will set Location B as closer\r\n       const distanceMap = new Map<LatLngLiteral, number>();\r\n       distanceMap.set(LISTING_A.position as LatLngLiteral, 20.8);\r\n       distanceMap.set(LISTING_B.position as LatLngLiteral, 20.7);\r\n       env.fakeGoogleMapsHarness!.distanceMatrixHandler = (request) =>\r\n           makeFakeDistanceMatrixResponse(request, distanceMap);\r\n       const distanceMatrixSpy =\r\n           spyOn(env.fakeGoogleMapsHarness!, 'distanceMatrixHandler')\r\n               .and.callThrough();\r\n\r\n       placePicker?.dispatchEvent(new Event('gmpx-placechange'));\r\n       await env.waitForStability();\r\n\r\n       expect(distanceMatrixSpy).toHaveBeenCalledOnceWith({\r\n         origins: [origin],\r\n         destinations: [LISTING_A.position, LISTING_B.position],\r\n         unitSystem: 0 as google.maps.UnitSystem.IMPERIAL,\r\n         travelMode: 'DRIVING' as google.maps.TravelMode,\r\n       });\r\n       expect(map?.innerMap?.fitBounds)\r\n           .toHaveBeenCalledOnceWith(\r\n               new FakeLatLngBounds({north: 10, south: 1, east: 10, west: 1}));\r\n       expect(sectionName?.textContent).toContain('Nearest locations (2)');\r\n       const items = resultsList!.children;\r\n       expect(items[0].textContent).toContain(LISTING_B.addressLines![0]);\r\n       expect(items[0].querySelector('.distance')?.textContent)\r\n           .toContain('20.7 0');\r\n     });\r\n\r\n  it('shows non-US travel distances in metric', async () => {\r\n    const {placePicker, map, resultsList} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n    map?.innerMap.fitBounds.calls.reset();\r\n    spyOnProperty(placePicker!, 'value').and.returnValue({\r\n      id: 'foo_origin_id',\r\n      location: new FakeLatLng(10, 10),\r\n      addressComponents:\r\n          [{types: ['foo', 'country'], shortText: 'CA', longText: 'Canada'}],\r\n    } as Partial<Place>as Place);\r\n\r\n    // Distance Matrix will set Location B as closer\r\n    const distanceMap = new Map<LatLngLiteral, number>();\r\n    distanceMap.set(LISTING_A.position as LatLngLiteral, 20.8);\r\n    distanceMap.set(LISTING_B.position as LatLngLiteral, 20.7);\r\n    env.fakeGoogleMapsHarness!.distanceMatrixHandler = (request) =>\r\n        makeFakeDistanceMatrixResponse(request, distanceMap);\r\n    spyOn(env.fakeGoogleMapsHarness!, 'distanceMatrixHandler')\r\n        .and.callThrough();\r\n\r\n    placePicker?.dispatchEvent(new Event('gmpx-placechange'));\r\n    await env.waitForStability();\r\n\r\n    // Fake Distance Matrix returns \"{distance} {units}\", with units indicating\r\n    // the requested value. 0 = imperial, 1 = metric per the Maps JS enum.\r\n    expect(resultsList!.children[0].querySelector('.distance')?.textContent)\r\n        .toContain('20.7 1');\r\n  });\r\n\r\n  it('shows place details', async () => {\r\n    const {resultsList, placeOverview, overlayLayout} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n    const items = resultsList!.children;\r\n    spyOn(overlayLayout!, 'showOverlay').and.callThrough();\r\n\r\n    items[1].querySelector<HTMLElement>('.view-details')!.click();\r\n    await env.waitForStability();\r\n\r\n    expect(overlayLayout?.showOverlay).toHaveBeenCalled();\r\n    expect(placeOverview?.place).toEqual(LISTING_B.placeId);\r\n  });\r\n\r\n  it('hides place details', async () => {\r\n    const {resultsList, overlayLayout, locatorRoot} = await prepareState(\r\n        {listings: [LISTING_A, LISTING_B], featureSet: FeatureSet.ADVANCED});\r\n    const items = resultsList!.children;\r\n    spyOn(overlayLayout!, 'hideOverlay').and.callThrough();\r\n    items[1].querySelector<HTMLElement>('.view-details')!.click();\r\n    await env.waitForStability();\r\n    locatorRoot.querySelector<HTMLElement>('.back-button')!.click();\r\n    await env.waitForStability();\r\n\r\n    expect(overlayLayout?.hideOverlay).toHaveBeenCalled();\r\n  });\r\n});"]}