{"version":3,"file":"suggest_validation_action_test.js","sourceRoot":"","sources":["../../src/address_validation/suggest_validation_action_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// import 'jasmine'; (google3-only)\r\n\r\nimport {Address, AddressComponent, AddressValidationResponse, ConfirmationLevel, Granularity, Verdict} from '../utils/googlemaps_types.js';\r\n\r\nimport {SuggestedAction, suggestValidationAction} from './suggest_validation_action.js';\r\n\r\nconst GOOD_VERDICT: Verdict = {\r\n  inputGranularity: Granularity.PREMISE,\r\n  validationGranularity: Granularity.PREMISE,\r\n  geocodeGranularity: Granularity.PREMISE,\r\n  isAddressComplete: true,\r\n  hasUnconfirmedComponents: false,\r\n  hasInferredComponents: false,\r\n  hasReplacedComponents: false,\r\n};\r\n\r\nconst LOCALITY_COMPONENT: AddressComponent = {\r\n  componentName: {text: 'Mountain View', languageCode: 'en'},\r\n  componentType: 'locality',\r\n  confirmationLevel: null,\r\n  isInferred: false,\r\n  isSpellCorrected: false,\r\n  isReplaced: false,\r\n  isUnexpected: false\r\n};\r\n\r\nfunction makeFakeValidationResponse(\r\n    address: Partial<Address>, verdict: Verdict): AddressValidationResponse {\r\n  return {\r\n    result: {\r\n      verdict,\r\n      address: {\r\n        formattedAddress: null,\r\n        postalAddress: null,\r\n        addressComponents: [],\r\n        ...address\r\n      },\r\n    },\r\n    responseId: ''\r\n  };\r\n}\r\n\r\ndescribe('SuggestValidationAction', () => {\r\n  it('returns FIX when an address is missing a non-subpremise component',\r\n     () => {\r\n       const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n           {missingComponentTypes: ['locality']}, GOOD_VERDICT));\r\n       expect(suggestion.suggestedAction).toBe(SuggestedAction.FIX);\r\n     });\r\n\r\n  it('returns FIX when the validation granularity is OTHER', () => {\r\n    const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n        {}, {...GOOD_VERDICT, validationGranularity: Granularity.OTHER}));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.FIX);\r\n  });\r\n\r\n  it('returns FIX when there is a suspicious component', () => {\r\n    const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n        {\r\n          addressComponents: [{\r\n            ...LOCALITY_COMPONENT,\r\n            confirmationLevel: ConfirmationLevel.UNCONFIRMED_AND_SUSPICIOUS\r\n          }]\r\n        },\r\n        GOOD_VERDICT));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.FIX);\r\n  });\r\n\r\n  it('returns FIX when there is an unresolved token', () => {\r\n    const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n        {unresolvedTokens: ['foobar']}, GOOD_VERDICT));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.FIX);\r\n  });\r\n\r\n  it('returns CONFIRM when there is a non-minor inferred component', () => {\r\n    const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n        {\r\n          addressComponents: [{\r\n            ...LOCALITY_COMPONENT,\r\n            isInferred: true,\r\n          }]\r\n        },\r\n        GOOD_VERDICT));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.CONFIRM);\r\n  });\r\n\r\n  it('returns CONFIRM when there is a replaced component', () => {\r\n    const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n        {}, {...GOOD_VERDICT, hasReplacedComponents: true}));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.CONFIRM);\r\n  });\r\n\r\n  it('returns ADD_SUBPREMISES when a US address doesn\\'t have one', () => {\r\n    const suggestion = suggestValidationAction(makeFakeValidationResponse(\r\n        {\r\n          missingComponentTypes: ['subpremise'],\r\n          postalAddress: {regionCode: 'US'}\r\n        },\r\n        GOOD_VERDICT));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.ADD_SUBPREMISES);\r\n  });\r\n\r\n  it('returns ACCEPT for a complete verdict without any issues', () => {\r\n    const suggestion =\r\n        suggestValidationAction(makeFakeValidationResponse({}, GOOD_VERDICT));\r\n    expect(suggestion.suggestedAction).toBe(SuggestedAction.ACCEPT);\r\n  });\r\n});\r\n"]}